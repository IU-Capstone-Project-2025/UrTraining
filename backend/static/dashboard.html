<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UrTraining - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-decoration: none;
        }

        .navbar .logo:hover {
            color: #f8f9fa;
        }

        .nav-center {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-link.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .navbar .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .navbar .username {
            color: white;
            font-weight: 500;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .profile-overview {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
            align-items: start;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 1rem;
        }

        .user-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .user-info-grid h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .user-info-grid p {
            margin-bottom: 0.5rem;
            color: #666;
        }

        .info-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .info-section h4 {
            color: #495057;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 0.5rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 500;
            color: #6c757d;
        }

        .info-value {
            color: #495057;
            font-weight: 500;
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .goal-tag {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .rating-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .rating-item-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .rating-stars {
            display: flex;
            gap: 2px;
        }

        .star {
            color: #ffc107;
            font-size: 1.2rem;
        }

        .star.empty {
            color: #e9ecef;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .action-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .action-card:hover {
            transform: translateY(-5px);
        }

        .action-card .icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .action-card h3 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .action-card p {
            color: #666;
            font-size: 0.9rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .message {
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-center {
                order: 2;
            }
            
            .nav-links {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .user-menu {
                order: 1;
                align-self: flex-end;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-overview {
                grid-template-columns: 1fr;
            }
            
            .user-info-grid {
                grid-template-columns: 1fr;
            }
            
            .goals-grid {
                grid-template-columns: 1fr;
            }
            
            .rating-display {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="/dashboard" class="logo">üèãÔ∏è UrTraining</a>
        <div class="nav-center">
            <div class="nav-links">
                <a href="/dashboard" class="nav-link active">Dashboard</a>
                <a href="/profile" class="nav-link">Profile</a>
                <a href="/security" class="nav-link">Security</a>
                <a href="/admin" class="nav-link">Admin</a>
            </div>
        </div>
        <div class="user-menu">
            <span class="username" id="navUsername">Loading...</span>
            <button id="logoutBtn" class="btn btn-danger">Logout</button>
        </div>
    </nav>

    <div class="container">
        <div id="message"></div>

        <div class="dashboard-grid">
            <div class="profile-overview">
                <div class="card">
                    <h2>üë§ Complete Profile Overview</h2>
                    <div id="userInfo">Loading user information...</div>
                </div>

                <div class="card">
                    <h2>‚ö° Quick Actions</h2>
                    <div class="actions-grid">
                        <a href="/profile" class="action-card">
                            <div class="icon">‚úèÔ∏è</div>
                            <h3>Edit Profile</h3>
                            <p>Update personal info and training profile</p>
                        </a>
                        <a href="/security" class="action-card">
                            <div class="icon">üîí</div>
                            <h3>Security</h3>
                            <p>Change your password</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let authToken = localStorage.getItem('authToken');

        // Redirect if not logged in
        if (!authToken) {
            window.location.href = '/';
        }

        // Show message function
        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // Helper function to format text
        function formatText(text) {
            if (!text) return 'Not set';
            return text.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // Helper function to generate star rating
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += `<span class="star ${i <= rating ? '' : 'empty'}">‚òÖ</span>`;
            }
            return stars;
        }

        // Display user information
        function displayUserInfo(userInfo) {
            const trainingProfile = userInfo.training_profile || {};
            const basicInfo = trainingProfile.basic_information || {};
            const goals = trainingProfile.training_goals || [];
            const experience = trainingProfile.training_experience || {};
            const preferences = trainingProfile.preferences || {};
            const health = trainingProfile.health || {};
            const types = trainingProfile.training_types || {};
            
            // Calculate BMI if height and weight are available
            let bmi = '';
            let bmiCategory = '';
            if (basicInfo.height_cm && basicInfo.weight_kg) {
                const heightM = basicInfo.height_cm / 100;
                const bmiValue = (basicInfo.weight_kg / (heightM * heightM)).toFixed(1);
                bmi = bmiValue;
                
                if (bmiValue < 18.5) bmiCategory = 'Underweight';
                else if (bmiValue < 25) bmiCategory = 'Normal';
                else if (bmiValue < 30) bmiCategory = 'Overweight';
                else bmiCategory = 'Obese';
            }
            
            document.getElementById('userInfo').innerHTML = `
                <!-- Account Information -->
                <div class="info-section">
                    <h4>üë§ Account Information</h4>
                    <div class="info-row">
                        <span class="info-label">Username:</span>
                        <span class="info-value">${userInfo.username || 'Not set'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Full Name:</span>
                        <span class="info-value">${userInfo.full_name || 'Not set'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Email:</span>
                        <span class="info-value">${userInfo.email || 'Not set'}</span>
                    </div>
                </div>

                <!-- Basic Information -->
                <div class="info-section">
                    <h4>üìä Basic Information</h4>
                    <div class="info-row">
                        <span class="info-label">Gender:</span>
                        <span class="info-value">${formatText(basicInfo.gender)}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Age:</span>
                        <span class="info-value">${basicInfo.age || 'Not set'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Height:</span>
                        <span class="info-value">${basicInfo.height_cm ? basicInfo.height_cm + ' cm' : 'Not set'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Weight:</span>
                        <span class="info-value">${basicInfo.weight_kg ? basicInfo.weight_kg + ' kg' : 'Not set'}</span>
                    </div>
                    ${bmi ? `
                    <div class="info-row">
                        <span class="info-label">BMI:</span>
                        <span class="info-value">${bmi} (${bmiCategory})</span>
                    </div>
                    ` : ''}
                </div>

                <!-- Training Goals -->
                ${goals.length > 0 ? `
                <div class="info-section">
                    <h4>üéØ Training Goals</h4>
                    <div class="goals-grid">
                        ${goals.map(goal => `<div class="goal-tag">${formatText(goal)}</div>`).join('')}
                    </div>
                </div>
                ` : `
                <div class="info-section">
                    <h4>üéØ Training Goals</h4>
                    <p style="color: #6c757d; font-style: italic;">No training goals set yet</p>
                </div>
                `}

                <!-- Experience & Frequency -->
                <div class="info-section">
                    <h4>üìà Training Experience</h4>
                    <div class="info-row">
                        <span class="info-label">Experience Level:</span>
                        <span class="info-value">${formatText(experience.level)}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Frequency (Last 3 Months):</span>
                        <span class="info-value">${formatText(experience.frequency_last_3_months)}</span>
                    </div>
                </div>

                <!-- Training Preferences -->
                <div class="info-section">
                    <h4>‚öôÔ∏è Training Preferences</h4>
                    <div class="info-row">
                        <span class="info-label">Location:</span>
                        <span class="info-value">${formatText(preferences.training_location || preferences.location)}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Location Details:</span>
                        <span class="info-value">${formatText(preferences.location_details)}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Session Duration:</span>
                        <span class="info-value">${formatText(preferences.session_duration)}</span>
                    </div>
                </div>

                <!-- Health Information -->
                <div class="info-section">
                    <h4>üè• Health Information</h4>
                    <div class="info-row">
                        <span class="info-label">Joint/Back Problems:</span>
                        <span class="info-value">${health.joint_back_problems ? 'Yes' : 'No'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Chronic Conditions:</span>
                        <span class="info-value">${health.chronic_conditions ? 'Yes' : 'No'}</span>
                    </div>
                    ${health.health_details ? `
                    <div class="info-row">
                        <span class="info-label">Details:</span>
                        <span class="info-value">${health.health_details}</span>
                    </div>
                    ` : ''}
                </div>

                <!-- Training Type Preferences -->
                ${Object.keys(types).length > 0 ? `
                <div class="info-section">
                    <h4>üí™ Training Type Preferences</h4>
                    <div class="rating-display">
                        ${Object.entries(types).map(([type, rating]) => `
                            <div class="rating-item-display">
                                <span>${formatText(type)}:</span>
                                <div class="rating-stars">${generateStars(rating)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : `
                <div class="info-section">
                    <h4>üí™ Training Type Preferences</h4>
                    <p style="color: #6c757d; font-style: italic;">No training type preferences set yet</p>
                </div>
                `}

                <!-- Profile Completion Stats -->
                <div class="info-section">
                    <h4>üìä Profile Completion</h4>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${calculateCompletionPercentage(userInfo)}%</div>
                            <div class="stat-label">Complete</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${goals.length}</div>
                            <div class="stat-label">Goals Set</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${Object.keys(types).length}</div>
                            <div class="stat-label">Types Rated</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('navUsername').textContent = userInfo.full_name || userInfo.username;
        }

        // Calculate profile completion percentage
        function calculateCompletionPercentage(userInfo) {
            const profile = userInfo.training_profile || {};
            const basic = profile.basic_information || {};
            const experience = profile.training_experience || {};
            const preferences = profile.training_preferences || {};
            const health = profile.health_information || {};
            const types = profile.training_types || {};
            const goals = profile.training_goals || [];

            let completed = 0;
            let total = 20; // Total number of profile fields

            // Account info (3 fields)
            if (userInfo.username) completed++;
            if (userInfo.full_name) completed++;
            if (userInfo.email) completed++;

            // Basic info (4 fields)
            if (basic.gender) completed++;
            if (basic.age) completed++;
            if (basic.height_cm) completed++;
            if (basic.weight_kg) completed++;

            // Experience (2 fields)
            if (experience.level) completed++;
            if (experience.frequency_last_3_months) completed++;

            // Preferences (3 fields)
            if (preferences.training_location || preferences.location) completed++;
            if (preferences.location_details) completed++;
            if (preferences.session_duration) completed++;

            // Health (2 fields - boolean fields count as completed if set)
            completed += 2; // joint_back_problems and chronic_conditions are always set (boolean)

            // Goals (1 field)
            if (goals.length > 0) completed++;

            // Training types (6 fields)
            const typeFields = ['strength_training', 'cardio', 'hiit', 'yoga_pilates', 'functional_training', 'stretching'];
            typeFields.forEach(field => {
                if (types[field]) completed++;
            });

            return Math.round((completed / total) * 100);
        }

        // Get user info
        async function getUserInfo() {
            try {
                const response = await fetch(`${API_BASE}/auth/training-profile`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayUserInfo(data);
                } else {
                    throw new Error('Failed to get user info');
                }
            } catch (error) {
                console.error('Error getting user info:', error);
                localStorage.removeItem('authToken');
                window.location.href = '/';
            }
        }

        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            try {
                await fetch(`${API_BASE}/auth/logout`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json',
                    }
                });
            } catch (error) {
                console.error('Logout error:', error);
            }
            
            localStorage.removeItem('authToken');
            window.location.href = '/';
        });

        // Initialize dashboard
        getUserInfo();
    </script>
</body>
</html> 