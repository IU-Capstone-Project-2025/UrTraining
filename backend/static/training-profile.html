<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UrTraining - Training Profile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            text-decoration: none;
        }

        .navbar .nav-links {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-link {
            color: #333;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .nav-link:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #6c757d;
        }

        .tab-btn:hover {
            background-color: #f8f9fa;
            color: #495057;
        }

        .tab-btn.active {
            background-color: #007bff;
            color: white;
        }

        .tab-content {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.hidden {
            display: none;
        }

        /* Form Layout */
        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .form-row .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        /* Checkbox Group */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .checkbox-group label:hover {
            background-color: #f8f9fa;
        }

        .checkbox-group input[type="checkbox"] {
            margin: 0;
        }

        /* Rating Buttons */
        .rating-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .rating-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        .rating-item label:first-child {
            font-weight: 500;
            min-width: 150px;
            margin: 0;
        }

        .rating-buttons {
            display: flex;
            gap: 8px;
        }

        .rating-buttons input[type="radio"] {
            display: none;
        }

        .rating-buttons label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            border: 2px solid #dee2e6;
            border-radius: 50%;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 0;
            font-size: 0.9rem;
        }

        .rating-buttons label:hover {
            border-color: #007bff;
            background-color: #e3f2fd;
        }

        .rating-buttons input[type="radio"]:checked + label {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .message {
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .form-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1.5rem;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        @media (max-width: 768px) {
            .tab-nav {
                flex-wrap: wrap;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .rating-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .rating-item label:first-child {
                min-width: auto;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                margin-right: 0;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="dashboard.html" class="logo">üèãÔ∏è UrTraining</a>
        <div class="nav-links">
            <a href="dashboard.html" class="nav-link">Dashboard</a>
            <a href="profile.html" class="nav-link">Profile</a>
            <a href="security.html" class="nav-link">Security</a>
        </div>
    </nav>

    <div class="container">
        <div id="message"></div>

        <div class="card">
            <h2>üèãÔ∏è Training Profile</h2>
            
            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button type="button" class="tab-btn active" data-tab="basic">Basic Info</button>
                <button type="button" class="tab-btn" data-tab="goals">Goals & Experience</button>
                <button type="button" class="tab-btn" data-tab="preferences">Preferences</button>
                <button type="button" class="tab-btn" data-tab="health">Health</button>
                <button type="button" class="tab-btn" data-tab="types">Training Types</button>
            </div>

            <form id="trainingProfileForm">
                <!-- Basic Information Tab -->
                <div id="basicTab" class="tab-content active">
                    <h3>üìä Basic Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="gender">Gender:</label>
                            <select id="gender" name="gender">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="age">Age:</label>
                            <input type="number" id="age" name="age" min="13" max="100">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="height">Height (cm):</label>
                            <input type="number" id="height" name="height_cm" min="100" max="250">
                        </div>
                        <div class="form-group">
                            <label for="weight">Weight (kg):</label>
                            <input type="number" id="weight" name="weight_kg" min="30" max="300" step="0.1">
                        </div>
                    </div>
                </div>

                <!-- Goals & Experience Tab -->
                <div id="goalsTab" class="tab-content hidden">
                    <h3>üéØ Goals & Experience</h3>
                    <div class="form-group">
                        <label>Training Goals:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="training_goals" value="weight_loss"> Weight Loss</label>
                            <label><input type="checkbox" name="training_goals" value="muscle_gain"> Muscle Gain</label>
                            <label><input type="checkbox" name="training_goals" value="maintain_fitness"> Maintain Fitness</label>
                            <label><input type="checkbox" name="training_goals" value="improve_endurance"> Improve Endurance</label>
                            <label><input type="checkbox" name="training_goals" value="improve_flexibility"> Improve Flexibility</label>
                            <label><input type="checkbox" name="training_goals" value="competition_preparation"> Competition Preparation</label>
                            <label><input type="checkbox" name="training_goals" value="strength_building"> Strength Building</label>
                            <label><input type="checkbox" name="training_goals" value="rehabilitation"> Rehabilitation</label>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trainingLevel">Experience Level:</label>
                            <select id="trainingLevel" name="training_level">
                                <option value="">Select Level</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="frequency">Frequency (Last 3 Months):</label>
                            <select id="frequency" name="frequency_last_3_months">
                                <option value="">Select Frequency</option>
                                <option value="not_trained">Not Trained</option>
                                <option value="1_2_times_week">1-2 Times/Week</option>
                                <option value="3_4_times_week">3-4 Times/Week</option>
                                <option value="5_6_times_week">5-6 Times/Week</option>
                                <option value="daily">Daily</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Preferences Tab -->
                <div id="preferencesTab" class="tab-content hidden">
                    <h3>‚öôÔ∏è Training Preferences</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trainingLocation">Training Location:</label>
                            <select id="trainingLocation" name="training_location">
                                <option value="">Select Location</option>
                                <option value="gym">Gym</option>
                                <option value="home">Home</option>
                                <option value="outdoor">Outdoor</option>
                                <option value="mixed">Mixed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="locationDetails">Location Details:</label>
                            <select id="locationDetails" name="location_details">
                                <option value="">Select Details</option>
                                <option value="full_fitness_center">Full Fitness Center</option>
                                <option value="basic_gym">Basic Gym</option>
                                <option value="home_equipment">Home Equipment</option>
                                <option value="no_equipment">No Equipment</option>
                                <option value="park_outdoor">Park/Outdoor</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sessionDuration">Session Duration:</label>
                        <select id="sessionDuration" name="session_duration">
                            <option value="">Select Duration</option>
                            <option value="15_30_min">15-30 Minutes</option>
                            <option value="30_45_min">30-45 Minutes</option>
                            <option value="45_60_min">45-60 Minutes</option>
                            <option value="60_90_min">60-90 Minutes</option>
                            <option value="90+_min">90+ Minutes</option>
                        </select>
                    </div>
                </div>

                <!-- Health Tab -->
                <div id="healthTab" class="tab-content hidden">
                    <h3>üè• Health Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="jointProblems" name="joint_back_problems">
                                Joint or Back Problems
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="chronicConditions" name="chronic_conditions">
                                Chronic Health Conditions
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="healthDetails">Health Details:</label>
                        <textarea id="healthDetails" name="health_details" rows="3" placeholder="Any specific health concerns, injuries, or medical conditions..."></textarea>
                    </div>
                </div>

                <!-- Training Types Tab -->
                <div id="typesTab" class="tab-content hidden">
                    <h3>üí™ Training Type Preferences</h3>
                    <p><small>Rate your interest level from 1 (lowest) to 5 (highest)</small></p>
                    
                    <div class="rating-group">
                        <div class="rating-item">
                            <label>Strength Training:</label>
                            <div class="rating-buttons">
                                <input type="radio" name="strength_training" value="1" id="str1"><label for="str1">1</label>
                                <input type="radio" name="strength_training" value="2" id="str2"><label for="str2">2</label>
                                <input type="radio" name="strength_training" value="3" id="str3"><label for="str3">3</label>
                                <input type="radio" name="strength_training" value="4" id="str4"><label for="str4">4</label>
                                <input type="radio" name="strength_training" value="5" id="str5"><label for="str5">5</label>
                            </div>
                        </div>
                        
                        <div class="rating-item">
                            <label>Cardio:</label>
                            <div class="rating-buttons">
                                <input type="radio" name="cardio" value="1" id="car1"><label for="car1">1</label>
                                <input type="radio" name="cardio" value="2" id="car2"><label for="car2">2</label>
                                <input type="radio" name="cardio" value="3" id="car3"><label for="car3">3</label>
                                <input type="radio" name="cardio" value="4" id="car4"><label for="car4">4</label>
                                <input type="radio" name="cardio" value="5" id="car5"><label for="car5">5</label>
                            </div>
                        </div>
                        
                        <div class="rating-item">
                            <label>HIIT:</label>
                            <div class="rating-buttons">
                                <input type="radio" name="hiit" value="1" id="hiit1"><label for="hiit1">1</label>
                                <input type="radio" name="hiit" value="2" id="hiit2"><label for="hiit2">2</label>
                                <input type="radio" name="hiit" value="3" id="hiit3"><label for="hiit3">3</label>
                                <input type="radio" name="hiit" value="4" id="hiit4"><label for="hiit4">4</label>
                                <input type="radio" name="hiit" value="5" id="hiit5"><label for="hiit5">5</label>
                            </div>
                        </div>
                        
                        <div class="rating-item">
                            <label>Yoga/Pilates:</label>
                            <div class="rating-buttons">
                                <input type="radio" name="yoga_pilates" value="1" id="yoga1"><label for="yoga1">1</label>
                                <input type="radio" name="yoga_pilates" value="2" id="yoga2"><label for="yoga2">2</label>
                                <input type="radio" name="yoga_pilates" value="3" id="yoga3"><label for="yoga3">3</label>
                                <input type="radio" name="yoga_pilates" value="4" id="yoga4"><label for="yoga4">4</label>
                                <input type="radio" name="yoga_pilates" value="5" id="yoga5"><label for="yoga5">5</label>
                            </div>
                        </div>
                        
                        <div class="rating-item">
                            <label>Functional Training:</label>
                            <div class="rating-buttons">
                                <input type="radio" name="functional_training" value="1" id="func1"><label for="func1">1</label>
                                <input type="radio" name="functional_training" value="2" id="func2"><label for="func2">2</label>
                                <input type="radio" name="functional_training" value="3" id="func3"><label for="func3">3</label>
                                <input type="radio" name="functional_training" value="4" id="func4"><label for="func4">4</label>
                                <input type="radio" name="functional_training" value="5" id="func5"><label for="func5">5</label>
                            </div>
                        </div>
                        
                        <div class="rating-item">
                            <label>Stretching:</label>
                            <div class="rating-buttons">
                                <input type="radio" name="stretching" value="1" id="stretch1"><label for="stretch1">1</label>
                                <input type="radio" name="stretching" value="2" id="stretch2"><label for="stretch2">2</label>
                                <input type="radio" name="stretching" value="3" id="stretch3"><label for="stretch3">3</label>
                                <input type="radio" name="stretching" value="4" id="stretch4"><label for="stretch4">4</label>
                                <input type="radio" name="stretching" value="5" id="stretch5"><label for="stretch5">5</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Update Training Profile</button>
                    <a href="dashboard.html" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let authToken = localStorage.getItem('authToken');

        // Redirect if not logged in
        if (!authToken) {
            window.location.href = 'login.html';
        }

        const trainingProfileForm = document.getElementById('trainingProfileForm');
        const messageDiv = document.getElementById('message');

        // Tab management
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                
                // Remove active class from all tabs and contents
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.add('hidden'));
                
                // Add active class to clicked tab and show corresponding content
                this.classList.add('active');
                document.getElementById(targetTab + 'Tab').classList.remove('hidden');
            });
        });

        // Show message function
        function showMessage(message, type = 'info') {
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // Set loading state
        function setLoading(element, loading) {
            if (loading) {
                element.classList.add('loading');
            } else {
                element.classList.remove('loading');
            }
        }

        // Load training profile data
        async function loadTrainingProfile() {
            try {
                const response = await fetch(`${API_BASE}/auth/training-profile`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    populateTrainingForm(data.training_profile);
                } else {
                    showMessage('Failed to load training profile', 'error');
                }
            } catch (error) {
                console.error('Error loading training profile:', error);
                showMessage('Network error loading training profile', 'error');
            }
        }

        // Populate training form with data
        function populateTrainingForm(trainingProfile) {
            const form = trainingProfileForm;
            
            // Basic Information
            const basicInfo = trainingProfile.basic_information || {};
            form.gender.value = basicInfo.gender || '';
            form.age.value = basicInfo.age || '';
            form.height_cm.value = basicInfo.height_cm || '';
            form.weight_kg.value = basicInfo.weight_kg || '';

            // Training Goals
            const goals = trainingProfile.training_goals || [];
            const goalCheckboxes = form.querySelectorAll('input[name="training_goals"]');
            goalCheckboxes.forEach(checkbox => {
                checkbox.checked = goals.includes(checkbox.value);
            });

            // Training Experience
            const experience = trainingProfile.training_experience || {};
            form.training_level.value = experience.level || '';
            form.frequency_last_3_months.value = experience.frequency_last_3_months || '';

            // Preferences
            const preferences = trainingProfile.preferences || {};
            form.training_location.value = preferences.training_location || '';
            form.location_details.value = preferences.location_details || '';
            form.session_duration.value = preferences.session_duration || '';

            // Health
            const health = trainingProfile.health || {};
            form.joint_back_problems.checked = health.joint_back_problems || false;
            form.chronic_conditions.checked = health.chronic_conditions || false;
            form.health_details.value = health.health_details || '';

            // Training Types
            const trainingTypes = trainingProfile.training_types || {};
            const typeFields = ['strength_training', 'cardio', 'hiit', 'yoga_pilates', 'functional_training', 'stretching'];
            typeFields.forEach(field => {
                const value = trainingTypes[field];
                if (value) {
                    const radio = form.querySelector(`input[name="${field}"][value="${value}"]`);
                    if (radio) radio.checked = true;
                }
            });
        }

        // Training profile form submission
        trainingProfileForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(trainingProfileForm);
            
            // Collect training goals
            const trainingGoals = [];
            formData.getAll('training_goals').forEach(goal => {
                trainingGoals.push(goal);
            });

            // Build training profile data
            const trainingData = {
                // Basic Information
                gender: formData.get('gender') || null,
                age: formData.get('age') ? parseInt(formData.get('age')) : null,
                height_cm: formData.get('height_cm') ? parseInt(formData.get('height_cm')) : null,
                weight_kg: formData.get('weight_kg') ? parseFloat(formData.get('weight_kg')) : null,
                
                // Training Goals
                training_goals: trainingGoals,
                
                // Training Experience
                training_level: formData.get('training_level') || null,
                frequency_last_3_months: formData.get('frequency_last_3_months') || null,
                
                // Preferences
                training_location: formData.get('training_location') || null,
                location_details: formData.get('location_details') || null,
                session_duration: formData.get('session_duration') || null,
                
                // Health
                joint_back_problems: formData.get('joint_back_problems') === 'on',
                chronic_conditions: formData.get('chronic_conditions') === 'on',
                health_details: formData.get('health_details') || null,
                
                // Training Types
                strength_training: formData.get('strength_training') ? parseInt(formData.get('strength_training')) : null,
                cardio: formData.get('cardio') ? parseInt(formData.get('cardio')) : null,
                hiit: formData.get('hiit') ? parseInt(formData.get('hiit')) : null,
                yoga_pilates: formData.get('yoga_pilates') ? parseInt(formData.get('yoga_pilates')) : null,
                functional_training: formData.get('functional_training') ? parseInt(formData.get('functional_training')) : null,
                stretching: formData.get('stretching') ? parseInt(formData.get('stretching')) : null
            };

            setLoading(trainingProfileForm, true);

            try {
                const response = await fetch(`${API_BASE}/auth/training-profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(trainingData)
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('Training profile updated successfully!', 'success');
                    
                    // Redirect to dashboard after short delay
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1500);
                } else {
                    showMessage(data.detail || 'Failed to update training profile', 'error');
                }
            } catch (error) {
                showMessage('Network error. Please try again.', 'error');
                console.error('Training profile update error:', error);
            } finally {
                setLoading(trainingProfileForm, false);
            }
        });

        // Initialize page
        loadTrainingProfile();
    </script>
</body>
</html> 